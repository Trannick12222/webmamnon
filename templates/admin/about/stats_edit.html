{% extends "admin/base.html" %}

{% block title %}Chỉnh sửa thống kê - Admin{% endblock %}

{% block page_title %}Chỉnh sửa thống kê{% endblock %}
{% block page_description %}Cập nhật thông tin thống kê "{{ about_stat.stat_label }}"{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="admin-card p-6">
        <form method="POST" class="space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <label for="stat_key" class="block text-sm font-medium text-gray-700 mb-2">
                        Khóa thống kê <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="stat_key" name="stat_key" 
                           value="{{ about_stat.stat_key }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="students, teachers, years..."
                           required>
                    <p class="text-sm text-gray-500 mt-1">Khóa duy nhất để phân biệt (không dấu, không khoảng trắng)</p>
                </div>
                
                <div>
                    <label for="stat_value" class="block text-sm font-medium text-gray-700 mb-2">
                        Giá trị <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="stat_value" name="stat_value" 
                           value="{{ about_stat.stat_value }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="200+, 25, 10+"
                           required>
                </div>
            </div>

            <div>
                <label for="stat_label" class="block text-sm font-medium text-gray-700 mb-2">
                    Nhãn hiển thị <span class="text-red-500">*</span>
                </label>
                <input type="text" id="stat_label" name="stat_label" 
                       value="{{ about_stat.stat_label }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                       placeholder="Học sinh, Giáo viên, Năm kinh nghiệm..."
                       required>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <label for="icon_class" class="block text-sm font-medium text-gray-700 mb-2">
                        Icon FontAwesome
                    </label>
                    <input type="text" id="icon_class" name="icon_class" 
                           value="{{ about_stat.icon_class }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="fas fa-users">
                    <p class="text-sm text-gray-500 mt-1">
                        Ví dụ: fas fa-users, fas fa-chalkboard-teacher, fas fa-graduation-cap
                    </p>
                </div>
                
                <div>
                    <label for="color_class" class="block text-sm font-medium text-gray-700 mb-2">
                        Màu sắc
                    </label>
                    <select id="color_class" name="color_class" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                        <option value="bg-primary" {{ 'selected' if about_stat.color_class == 'bg-primary' }}>Cam chính (Primary)</option>
                        <option value="bg-secondary" {{ 'selected' if about_stat.color_class == 'bg-secondary' }}>Vàng cam (Secondary)</option>
                        <option value="bg-blue-500" {{ 'selected' if about_stat.color_class == 'bg-blue-500' }}>Xanh dương</option>
                        <option value="bg-green-500" {{ 'selected' if about_stat.color_class == 'bg-green-500' }}>Xanh lá</option>
                        <option value="bg-purple-500" {{ 'selected' if about_stat.color_class == 'bg-purple-500' }}>Tím</option>
                        <option value="bg-red-500" {{ 'selected' if about_stat.color_class == 'bg-red-500' }}>Đỏ</option>
                        <option value="bg-yellow-500" {{ 'selected' if about_stat.color_class == 'bg-yellow-500' }}>Vàng</option>
                        <option value="bg-pink-500" {{ 'selected' if about_stat.color_class == 'bg-pink-500' }}>Hồng</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <label for="order_index" class="block text-sm font-medium text-gray-700 mb-2">
                        Thứ tự hiển thị
                    </label>
                    <input type="number" id="order_index" name="order_index" 
                           value="{{ about_stat.order_index }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           min="0">
                    <p class="text-sm text-gray-500 mt-1">Số nhỏ hơn sẽ hiển thị trước</p>
                </div>
                
                <div class="flex items-center pt-6">
                    <input type="checkbox" id="is_active" name="is_active" value="1" 
                           {{ 'checked' if about_stat.is_active }}
                           class="w-4 h-4 text-orange-600 bg-gray-100 border-gray-300 rounded focus:ring-orange-500">
                    <label for="is_active" class="ml-2 text-sm font-medium text-gray-700">
                        Hiển thị trên website
                    </label>
                </div>
            </div>

            <!-- Preview -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="text-sm font-medium text-gray-700 mb-3">Xem trước:</h4>
                <div class="bg-white rounded-lg p-4 border max-w-xs">
                    <div class="w-12 h-12 {{ about_stat.color_class }} rounded-lg flex items-center justify-center mx-auto mb-3">
                        <i class="{{ about_stat.icon_class }} text-white"></i>
                    </div>
                    <h3 class="text-xl font-bold {{ about_stat.color_class.replace('bg-', 'text-') }} text-center mb-1">{{ about_stat.stat_value }}</h3>
                    <p class="text-gray-600 text-sm text-center">{{ about_stat.stat_label }}</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                <a href="{{ url_for('admin_about') }}" 
                   class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Quay lại
                </a>
                
                <div class="flex space-x-3">
                    <form method="POST" action="{{ url_for('admin_about_stats_delete', id=about_stat.id) }}" class="inline-block">
                        <button type="submit" 
                                class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition delete-btn"
                                onclick="return confirm('Bạn có chắc chắn muốn xóa thống kê này?')">
                            <i class="fas fa-trash mr-2"></i>
                            Xóa
                        </button>
                    </form>
                    
                    <button type="submit" 
                            class="btn-primary px-8 py-2 rounded-lg font-medium">
                        <i class="fas fa-save mr-2"></i>
                        Lưu thay đổi
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
// Live preview update
document.addEventListener('DOMContentLoaded', function() {
    const statValue = document.getElementById('stat_value');
    const statLabel = document.getElementById('stat_label');
    const iconClass = document.getElementById('icon_class');
    const colorClass = document.getElementById('color_class');
    
    const previewValue = document.querySelector('.bg-white h3');
    const previewLabel = document.querySelector('.bg-white p');
    const previewIcon = document.querySelector('.bg-white i');
    const previewBg = document.querySelector('.bg-white .w-12');
    
    function updatePreview() {
        if (statValue.value) previewValue.textContent = statValue.value;
        if (statLabel.value) previewLabel.textContent = statLabel.value;
        if (iconClass.value) previewIcon.className = iconClass.value + ' text-white';
        
        // Update background color
        previewBg.className = 'w-12 h-12 ' + colorClass.value + ' rounded-lg flex items-center justify-center mx-auto mb-3';
        
        // Update text color
        const textColorMap = {
            'bg-primary': 'text-primary',
            'bg-secondary': 'text-secondary',
            'bg-blue-500': 'text-blue-500',
            'bg-green-500': 'text-green-500',
            'bg-purple-500': 'text-purple-500',
            'bg-red-500': 'text-red-500',
            'bg-yellow-500': 'text-yellow-500',
            'bg-pink-500': 'text-pink-500'
        };
        previewValue.className = 'text-xl font-bold ' + (textColorMap[colorClass.value] || 'text-primary') + ' text-center mb-1';
    }
    
    statValue.addEventListener('input', updatePreview);
    statLabel.addEventListener('input', updatePreview);
    iconClass.addEventListener('input', updatePreview);
    colorClass.addEventListener('change', updatePreview);
});
</script>
{% endblock %}
