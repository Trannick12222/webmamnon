{% extends "admin/base.html" %}

{% block title %}Chỉnh sửa thống kê - Admin{% endblock %}
{% block page_title %}Chỉnh sửa thống kê{% endblock %}
{% block page_description %}Cập nhật thông tin thống kê "{{ home_stat.stat_label }}"{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Form Section -->
        <div class="admin-card p-6">
            <form method="POST" class="space-y-6">
                <div>
                    <label for="stat_key" class="block text-sm font-medium text-gray-700 mb-2">
                        Khóa thống kê <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="stat_key" name="stat_key" required value="{{ home_stat.stat_key }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="students, teachers, experience">
                    <p class="text-xs text-gray-500 mt-1">Khóa duy nhất để định danh thống kê</p>
                </div>

                <div>
                    <label for="stat_value" class="block text-sm font-medium text-gray-700 mb-2">
                        Giá trị <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="stat_value" name="stat_value" required value="{{ home_stat.stat_value }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="200+, 25, 10+, 95%">
                </div>

                <div>
                    <label for="stat_label" class="block text-sm font-medium text-gray-700 mb-2">
                        Nhãn hiển thị <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="stat_label" name="stat_label" required value="{{ home_stat.stat_label }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="Học sinh, Giáo viên, Năm, Hài lòng">
                </div>

                <div>
                    <label for="stat_description" class="block text-sm font-medium text-gray-700 mb-2">
                        Mô tả phụ
                    </label>
                    <input type="text" id="stat_description" name="stat_description" value="{{ home_stat.stat_description or '' }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="hiện tại, chuyên nghiệp, kinh nghiệm, phụ huynh">
                    <p class="text-xs text-gray-500 mt-1">Văn bản mô tả bổ sung (tùy chọn)</p>
                </div>

                <div>
                    <label for="icon_class" class="block text-sm font-medium text-gray-700 mb-2">
                        Icon <span class="text-red-500">*</span>
                    </label>
                    <select id="icon_class" name="icon_class" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                        <option value="">Chọn icon</option>
                        <option value="fas fa-users" {% if home_stat.icon_class == 'fas fa-users' %}selected{% endif %}>👥 Người dùng (fas fa-users)</option>
                        <option value="fas fa-chalkboard-teacher" {% if home_stat.icon_class == 'fas fa-chalkboard-teacher' %}selected{% endif %}>👨‍🏫 Giáo viên (fas fa-chalkboard-teacher)</option>
                        <option value="fas fa-calendar-alt" {% if home_stat.icon_class == 'fas fa-calendar-alt' %}selected{% endif %}>📅 Lịch (fas fa-calendar-alt)</option>
                        <option value="fas fa-star" {% if home_stat.icon_class == 'fas fa-star' %}selected{% endif %}>⭐ Ngôi sao (fas fa-star)</option>
                        <option value="fas fa-graduation-cap" {% if home_stat.icon_class == 'fas fa-graduation-cap' %}selected{% endif %}>🎓 Tốt nghiệp (fas fa-graduation-cap)</option>
                        <option value="fas fa-school" {% if home_stat.icon_class == 'fas fa-school' %}selected{% endif %}>🏫 Trường học (fas fa-school)</option>
                        <option value="fas fa-trophy" {% if home_stat.icon_class == 'fas fa-trophy' %}selected{% endif %}>🏆 Cúp (fas fa-trophy)</option>
                        <option value="fas fa-heart" {% if home_stat.icon_class == 'fas fa-heart' %}selected{% endif %}>❤️ Trái tim (fas fa-heart)</option>
                        <option value="fas fa-gamepad" {% if home_stat.icon_class == 'fas fa-gamepad' %}selected{% endif %}>🎮 Hoạt động (fas fa-gamepad)</option>
                        <option value="fas fa-book" {% if home_stat.icon_class == 'fas fa-book' %}selected{% endif %}>📚 Sách (fas fa-book)</option>
                    </select>
                </div>

                <div>
                    <label for="color_class" class="block text-sm font-medium text-gray-700 mb-2">
                        Màu sắc <span class="text-red-500">*</span>
                    </label>
                    <select id="color_class" name="color_class" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                        <option value="">Chọn màu</option>
                        <option value="bg-orange-500" {% if home_stat.color_class == 'bg-orange-500' %}selected{% endif %}>🟠 Cam (bg-orange-500)</option>
                        <option value="bg-red-500" {% if home_stat.color_class == 'bg-red-500' %}selected{% endif %}>🔴 Đỏ (bg-red-500)</option>
                        <option value="bg-green-500" {% if home_stat.color_class == 'bg-green-500' %}selected{% endif %}>🟢 Xanh lá (bg-green-500)</option>
                        <option value="bg-blue-500" {% if home_stat.color_class == 'bg-blue-500' %}selected{% endif %}>🔵 Xanh dương (bg-blue-500)</option>
                        <option value="bg-yellow-500" {% if home_stat.color_class == 'bg-yellow-500' %}selected{% endif %}>🟡 Vàng (bg-yellow-500)</option>
                        <option value="bg-purple-500" {% if home_stat.color_class == 'bg-purple-500' %}selected{% endif %}>🟣 Tím (bg-purple-500)</option>
                        <option value="bg-pink-500" {% if home_stat.color_class == 'bg-pink-500' %}selected{% endif %}>🩷 Hồng (bg-pink-500)</option>
                        <option value="bg-indigo-500" {% if home_stat.color_class == 'bg-indigo-500' %}selected{% endif %}>🟦 Indigo (bg-indigo-500)</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="order_index" class="block text-sm font-medium text-gray-700 mb-2">
                            Thứ tự hiển thị
                        </label>
                        <input type="number" id="order_index" name="order_index" min="0" value="{{ home_stat.order_index }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                    </div>

                    <div class="flex items-end">
                        <label class="flex items-center">
                            <input type="checkbox" id="is_active" name="is_active" {% if home_stat.is_active %}checked{% endif %}
                                   class="h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">Hiển thị</span>
                        </label>
                    </div>
                </div>

                <div class="flex items-center justify-between pt-6">
                    <a href="{{ url_for('admin_home_stats') }}" 
                       class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition duration-200">
                        <i class="fas fa-arrow-left mr-2"></i>Quay lại
                    </a>
                    
                    <button type="submit"
                            class="btn-primary px-6 py-3 rounded-lg hover:bg-orange-600 transition duration-200">
                        <i class="fas fa-save mr-2"></i>Cập nhật thống kê
                    </button>
                </div>
            </form>
        </div>

        <!-- Preview Section -->
        <div class="admin-card p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Xem trước</h3>
            
            <div class="text-center p-6 rounded-lg" style="background: linear-gradient(to right, var(--primary-color), var(--secondary-color))">
                <div id="preview-icon" class="w-16 h-16 {{ home_stat.color_class }} rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="{{ home_stat.icon_class }} text-white text-2xl"></i>
                </div>
                <div id="preview-value" class="text-4xl font-bold text-white mb-2">{{ home_stat.stat_value }}</div>
                <div id="preview-label" class="text-lg text-white font-medium">{{ home_stat.stat_label }}</div>
                <div id="preview-description" class="text-white/80 text-sm">{{ home_stat.stat_description or '' }}</div>
            </div>

            <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                <h4 class="font-medium text-gray-800 mb-2">Hướng dẫn:</h4>
                <ul class="text-sm text-gray-600 space-y-1">
                    <li>• Khóa thống kê nên ngắn gọn và duy nhất</li>
                    <li>• Giá trị có thể là số hoặc phần trăm</li>
                    <li>• Chọn icon phù hợp với nội dung</li>
                    <li>• Màu sắc sẽ hiển thị trên nền gradient</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Update preview when form fields change
    function updatePreview() {
        const value = document.getElementById('stat_value').value;
        const label = document.getElementById('stat_label').value;
        const description = document.getElementById('stat_description').value;
        const iconClass = document.getElementById('icon_class').value;
        const colorClass = document.getElementById('color_class').value;
        
        document.getElementById('preview-value').textContent = value;
        document.getElementById('preview-label').textContent = label;
        document.getElementById('preview-description').textContent = description;
        
        if (iconClass) {
            const iconElement = document.querySelector('#preview-icon i');
            iconElement.className = iconClass + ' text-white text-2xl';
        }
        
        if (colorClass) {
            const iconContainer = document.getElementById('preview-icon');
            iconContainer.className = 'w-16 h-16 ' + colorClass + ' rounded-full flex items-center justify-center mx-auto mb-4';
        }
    }
    
    // Add event listeners
    document.getElementById('stat_value').addEventListener('input', updatePreview);
    document.getElementById('stat_label').addEventListener('input', updatePreview);
    document.getElementById('stat_description').addEventListener('input', updatePreview);
    document.getElementById('icon_class').addEventListener('change', updatePreview);
    document.getElementById('color_class').addEventListener('change', updatePreview);
    
    // Initial preview update
    updatePreview();
});
</script>
{% endblock %}
