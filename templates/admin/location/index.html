{% extends "admin/base.html" %}

{% block title %}Quản lý Vị trí & Bản đồ{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="text-gradient font-weight-bold mb-2">
                        <i class="fas fa-map-marked-alt mr-2"></i>
                        Quản lý Vị trí & Bản đồ
                    </h2>
                    <p class="text-muted mb-0">Cấu hình thông tin địa chỉ và bản đồ Google Maps cho website</p>
                </div>
                <a href="{{ url_for('admin_location_edit') }}" class="btn btn-primary btn-enhanced">
                    <i class="fas fa-edit"></i> Chỉnh sửa
                </a>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12">
            <div class="admin-card">
                <div class="card-header bg-transparent border-0 pb-0">
                    <div class="d-flex align-items-center">
                        <div class="card-icon bg-primary text-white rounded-circle mr-3" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div>
                            <h4 class="mb-0 font-weight-bold">Cài đặt Vị trí & Google Maps</h4>
                            <small class="text-muted">Quản lý thông tin địa chỉ và hiển thị bản đồ</small>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    {% if location_settings %}
                        <div class="row">
                            <!-- Thông tin địa chỉ -->
                            <div class="col-lg-6 mb-4">
                                <div class="location-info-card">
                                    <div class="card-icon">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </div>
                                    <h5 class="font-weight-bold mb-3">Thông tin địa chỉ</h5>
                                    <div class="info-item mb-3">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-home mr-2 mt-1" style="opacity: 0.8;"></i>
                                            <div>
                                                <small class="d-block opacity-75">Địa chỉ</small>
                                                <span class="font-weight-medium">{{ location_settings.address }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="info-item">
                                                <div class="d-flex align-items-start">
                                                    <i class="fas fa-globe mr-2 mt-1" style="opacity: 0.8;"></i>
                                                    <div>
                                                        <small class="d-block opacity-75">Vĩ độ</small>
                                                        <span class="font-weight-medium">{{ location_settings.latitude or 'Chưa thiết lập' }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="info-item">
                                                <div class="d-flex align-items-start">
                                                    <i class="fas fa-globe mr-2 mt-1" style="opacity: 0.8;"></i>
                                                    <div>
                                                        <small class="d-block opacity-75">Kinh độ</small>
                                                        <span class="font-weight-medium">{{ location_settings.longitude or 'Chưa thiết lập' }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="info-item mt-3">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-tag mr-2 mt-1" style="opacity: 0.8;"></i>
                                            <div>
                                                <small class="d-block opacity-75">Tiêu đề marker</small>
                                                <span class="font-weight-medium">{{ location_settings.marker_title }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    {% if location_settings.marker_info %}
                                    <div class="info-item mt-3">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-info-circle mr-2 mt-1" style="opacity: 0.8;"></i>
                                            <div>
                                                <small class="d-block opacity-75">Thông tin marker</small>
                                                <span class="font-weight-medium">{{ location_settings.marker_info }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Cài đặt bản đồ -->
                            <div class="col-lg-6 mb-4">
                                <div class="location-settings-card">
                                    <div class="card-icon">
                                        <i class="fas fa-cogs"></i>
                                    </div>
                                    <h5 class="font-weight-bold mb-3">Cài đặt bản đồ</h5>
                                    <div class="info-item mb-3">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-key mr-2" style="opacity: 0.8;"></i>
                                                <span>API Key</span>
                                            </div>
                                            {% if location_settings.google_maps_api_key %}
                                                <span class="status-badge success">
                                                    <i class="fas fa-check mr-1"></i>Đã thiết lập
                                                </span>
                                            {% else %}
                                                <span class="status-badge warning">
                                                    <i class="fas fa-exclamation-triangle mr-1"></i>Chưa thiết lập
                                                </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="info-item mb-3">
                                                <div class="d-flex align-items-start">
                                                    <i class="fas fa-search-plus mr-2 mt-1" style="opacity: 0.8;"></i>
                                                    <div>
                                                        <small class="d-block opacity-75">Mức zoom</small>
                                                        <span class="font-weight-medium">{{ location_settings.map_zoom_level }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="info-item mb-3">
                                                <div class="d-flex align-items-start">
                                                    <i class="fas fa-layer-group mr-2 mt-1" style="opacity: 0.8;"></i>
                                                    <div>
                                                        <small class="d-block opacity-75">Kiểu bản đồ</small>
                                                        <span class="font-weight-medium text-capitalize">{{ location_settings.map_style }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="info-item mb-3">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-arrows-alt-v mr-2 mt-1" style="opacity: 0.8;"></i>
                                            <div>
                                                <small class="d-block opacity-75">Chiều cao</small>
                                                <span class="font-weight-medium">{{ location_settings.map_height }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-eye mr-2" style="opacity: 0.8;"></i>
                                            <span>Hiển thị footer</span>
                                        </div>
                                        {% if location_settings.show_in_footer %}
                                            <span class="status-badge success">
                                                <i class="fas fa-check mr-1"></i>Có
                                            </span>
                                        {% else %}
                                            <span class="status-badge info">
                                                <i class="fas fa-times mr-1"></i>Không
                                            </span>
                                        {% endif %}
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-power-off mr-2" style="opacity: 0.8;"></i>
                                            <span>Trạng thái</span>
                                        </div>
                                        {% if location_settings.is_active %}
                                            <span class="status-badge success">
                                                <i class="fas fa-check-circle mr-1"></i>Hoạt động
                                            </span>
                                        {% else %}
                                            <span class="status-badge info">
                                                <i class="fas fa-pause-circle mr-1"></i>Tạm dừng
                                            </span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Map Preview Section -->
                        {% if location_settings.google_maps_embed %}
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h4 class="mb-0 font-weight-bold">
                                        <i class="fas fa-map-marked-alt text-primary mr-2"></i>
                                        Xem trước bản đồ
                                    </h4>
                                    <span class="status-badge success">
                                        <i class="fas fa-check-circle mr-1"></i>
                                        Đã cấu hình
                                    </span>
                                </div>
                                
                                <!-- Enhanced Map Container -->
                                <div class="map-preview-container">
                                    <div class="map-header">
                                        <div class="d-flex align-items-center">
                                            <div class="map-icon">
                                                <i class="fas fa-map"></i>
                                            </div>
                                            <div class="ml-3">
                                                <h6 class="mb-0 text-white font-weight-bold">Bản đồ từ Google Maps</h6>
                                            </div>
                                        </div>
                                        <div class="map-status d-flex align-items-center">
                                            <div class="status-indicator bg-success rounded-circle mr-2" style="width: 8px; height: 8px;"></div>
                                            <span class="text-white-50">Hoạt động</span>
                                        </div>
                                    </div>
                                    
                                    <div class="map-content map-content-enhanced">
                                        {{ location_settings.google_maps_embed|safe }}
                                    </div>
                                    
                                    <div class="map-footer">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="map-info">
                                                <small class="text-muted d-flex align-items-center">
                                                    <i class="fas fa-info-circle mr-2 text-primary"></i>
                                                    Bản đồ sẽ hiển thị trong footer website nếu được kích hoạt
                                                </small>
                                            </div>
                                            <div class="map-actions">
                                                <a href="{{ url_for('admin_location_edit') }}" class="btn btn-enhanced btn-info btn-sm">
                                                    <i class="fas fa-edit"></i>
                                                    Chỉnh sửa
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% elif location_settings.latitude and location_settings.longitude %}
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h4 class="mb-0 font-weight-bold">
                                        <i class="fas fa-map-marker-alt text-warning mr-2"></i>
                                        Thông tin tọa độ
                                    </h4>
                                    <span class="status-badge warning">
                                        <i class="fas fa-exclamation-triangle mr-1"></i>
                                        Cần iframe
                                    </span>
                                </div>
                                
                                <div class="alert-enhanced alert-warning">
                                    <div class="d-flex align-items-start">
                                        <div class="alert-icon">
                                            <i class="fas fa-map-marker-alt fa-2x"></i>
                                        </div>
                                        <div class="ml-4 flex-grow-1">
                                            <h5 class="font-weight-bold mb-3">Tọa độ đã được thiết lập</h5>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-globe mr-2"></i>
                                                        <div>
                                                            <small class="d-block text-muted">Vĩ độ</small>
                                                            <strong>{{ location_settings.latitude }}</strong>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-globe mr-2"></i>
                                                        <div>
                                                            <small class="d-block text-muted">Kinh độ</small>
                                                            <strong>{{ location_settings.longitude }}</strong>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center p-3 bg-white rounded-lg">
                                                <i class="fas fa-lightbulb text-warning mr-2"></i>
                                                <span class="text-muted">
                                                    Để hiển thị bản đồ, vui lòng thêm iframe code từ Google Maps trong phần chỉnh sửa.
                                                </span>
                                            </div>
                                        </div>
                                        <div class="ml-3">
                                            <a href="{{ url_for('admin_location_edit') }}" class="btn btn-enhanced btn-warning">
                                                <i class="fas fa-plus"></i>
                                                Thêm iframe
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    {% else %}
                        <!-- Empty State -->
                        <div class="text-center py-5">
                            <div class="mb-4">
                                <i class="fas fa-map-marked-alt fa-4x text-muted opacity-50"></i>
                            </div>
                            <h4 class="font-weight-bold text-muted mb-3">Chưa có cài đặt vị trí</h4>
                            <p class="text-muted mb-4">
                                Bạn chưa cấu hình thông tin địa chỉ và bản đồ cho website.<br>
                                Hãy tạo mới để bắt đầu cấu hình.
                            </p>
                            <a href="{{ url_for('admin_location_edit') }}" class="btn btn-primary btn-enhanced">
                                <i class="fas fa-plus mr-2"></i>
                                Tạo cài đặt mới
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Additional inline styles for better visual effects */
.text-gradient {
    background: linear-gradient(45deg, #ff6b35, #f7931e);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.opacity-50 {
    opacity: 0.5;
}

.opacity-75 {
    opacity: 0.75;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.font-weight-medium {
    font-weight: 500;
}

/* Animation for cards */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.location-info-card,
.location-settings-card {
    animation: slideInUp 0.6s ease-out;
}

.location-settings-card {
    animation-delay: 0.2s;
}

.map-preview-container {
    animation: slideInUp 0.8s ease-out;
}

/* Enhanced map content styling */
.map-content {
    position: relative;
    overflow: hidden;
}

.map-content-enhanced {
    min-height: 450px;
    height: 450px;
}

.map-content iframe {
    width: 100% !important;
    height: 100% !important;
    border: none;
    border-radius: 0;
}

/* Responsive map heights */
@media (max-width: 768px) {
    .map-content-enhanced {
        min-height: 350px !important;
        height: 350px !important;
    }
}

@media (max-width: 480px) {
    .map-content-enhanced {
        min-height: 300px !important;
        height: 300px !important;
    }
}
</style>

{% endblock %}
