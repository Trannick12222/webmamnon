{% extends "admin/base.html" %}

{% block title %}Chỉnh sửa Nhóm độ tuổi - Admin{% endblock %}

{% block page_title %}Chỉnh sửa nhóm độ tuổi{% endblock %}
{% block page_description %}Cập nhật thông tin nhóm độ tuổi: {{ age_group.name }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- Back Button -->
    <div class="flex items-center space-x-4">
        <a href="{{ url_for('admin_age_groups') }}" 
           class="flex items-center text-gray-600 hover:text-gray-800 transition">
            <i class="fas fa-arrow-left mr-2"></i>
            Quay lại danh sách
        </a>
    </div>

    <!-- Form -->
    <form method="POST" class="space-y-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Column -->
            <div class="space-y-6">
                <!-- Basic Information -->
                <div class="admin-card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                        Thông tin cơ bản
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Tên lớp <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="name" value="{{ age_group.name }}" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="VD: Lớp Mầm, Lớp Chồi">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Độ tuổi <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="age_range" value="{{ age_group.age_range }}" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="VD: 18-24 tháng, 2-3 tuổi">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Mô tả
                            </label>
                            <textarea name="description" rows="3" 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                      placeholder="Mô tả ngắn gọn về nhóm độ tuổi này">{{ age_group.description or '' }}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Thứ tự hiển thị
                            </label>
                            <input type="number" name="order_index" value="{{ age_group.order_index }}" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <p class="text-xs text-gray-500 mt-1">Số càng nhỏ càng hiển thị trước</p>
                        </div>
                        
                        <div class="flex items-center">
                            <input type="checkbox" name="is_active" id="is_active" 
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                                   {{ 'checked' if age_group.is_active else '' }}>
                            <label for="is_active" class="ml-2 text-sm font-medium text-gray-700">
                                Hiển thị trên trang web
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Skills -->
                <div class="admin-card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-list text-green-500 mr-2"></i>
                        Kỹ năng phát triển
                    </h3>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Danh sách kỹ năng
                        </label>
                        <textarea name="skills" rows="6" 
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="• Phát triển vận động cơ bản&#10;• Học tự lập trong ăn uống&#10;• Giao tiếp đơn giản&#10;• Khám phá thế giới xung quanh">{{ age_group.skills or '' }}</textarea>
                        <p class="text-xs text-gray-500 mt-1">Mỗi kỹ năng trên một dòng</p>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-6">
                <!-- Icon & Colors -->
                <div class="admin-card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-palette text-purple-500 mr-2"></i>
                        Icon & Màu sắc
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Icon class (Font Awesome)
                            </label>
                            <input type="text" name="icon_class" value="{{ age_group.icon_class }}" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="VD: fas fa-baby, fas fa-seedling">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Màu nền icon (Tailwind class)
                            </label>
                            <select name="icon_bg_color" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="bg-pink-100" {{ 'selected' if age_group.icon_bg_color == 'bg-pink-100' else '' }}>Pink (bg-pink-100)</option>
                                <option value="bg-green-100" {{ 'selected' if age_group.icon_bg_color == 'bg-green-100' else '' }}>Green (bg-green-100)</option>
                                <option value="bg-blue-100" {{ 'selected' if age_group.icon_bg_color == 'bg-blue-100' else '' }}>Blue (bg-blue-100)</option>
                                <option value="bg-yellow-100" {{ 'selected' if age_group.icon_bg_color == 'bg-yellow-100' else '' }}>Yellow (bg-yellow-100)</option>
                                <option value="bg-purple-100" {{ 'selected' if age_group.icon_bg_color == 'bg-purple-100' else '' }}>Purple (bg-purple-100)</option>
                                <option value="bg-orange-100" {{ 'selected' if age_group.icon_bg_color == 'bg-orange-100' else '' }}>Orange (bg-orange-100)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Màu icon (Tailwind class)
                            </label>
                            <select name="icon_text_color" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="text-pink-600" {{ 'selected' if age_group.icon_text_color == 'text-pink-600' else '' }}>Pink (text-pink-600)</option>
                                <option value="text-green-600" {{ 'selected' if age_group.icon_text_color == 'text-green-600' else '' }}>Green (text-green-600)</option>
                                <option value="text-blue-600" {{ 'selected' if age_group.icon_text_color == 'text-blue-600' else '' }}>Blue (text-blue-600)</option>
                                <option value="text-yellow-600" {{ 'selected' if age_group.icon_text_color == 'text-yellow-600' else '' }}>Yellow (text-yellow-600)</option>
                                <option value="text-purple-600" {{ 'selected' if age_group.icon_text_color == 'text-purple-600' else '' }}>Purple (text-purple-600)</option>
                                <option value="text-orange-600" {{ 'selected' if age_group.icon_text_color == 'text-orange-600' else '' }}>Orange (text-orange-600)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Preview -->
                <div class="admin-card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-eye text-indigo-500 mr-2"></i>
                        Xem trước
                    </h3>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-lg text-center border">
                        <div class="w-16 h-16 {{ age_group.icon_bg_color }} rounded-full flex items-center justify-center mx-auto mb-4" id="preview-icon-bg">
                            <i class="{{ age_group.icon_class }} {{ age_group.icon_text_color }} text-2xl" id="preview-icon"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800 mb-2" id="preview-age">{{ age_group.age_range }}</h3>
                        <h4 class="text-primary font-semibold mb-3" id="preview-name">{{ age_group.name }}</h4>
                        <div class="text-sm text-gray-600 space-y-1" id="preview-skills">
                            {% if age_group.skills %}
                                {% set skills_list = age_group.skills.split('\n') %}
                                {% for skill in skills_list[:4] %}
                                    {% if skill.strip() %}
                                    <div>{{ skill.strip() }}</div>
                                    {% endif %}
                                {% endfor %}
                                {% if skills_list|length > 4 %}
                                <div class="text-gray-400">... và nhiều kỹ năng khác</div>
                                {% endif %}
                            {% else %}
                                <div>Nhập kỹ năng để xem trước</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div class="flex items-center justify-end space-x-4 pt-6 border-t">
            <a href="{{ url_for('admin_age_groups') }}" 
               class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition">
                Hủy
            </a>
            <button type="submit" 
                    class="btn-primary px-6 py-2 rounded-lg font-medium">
                <i class="fas fa-save mr-2"></i>
                Cập nhật nhóm độ tuổi
            </button>
        </div>
    </form>
</div>

<script>
// Live preview functionality
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.querySelector('input[name="name"]');
    const ageInput = document.querySelector('input[name="age_range"]');
    const skillsInput = document.querySelector('textarea[name="skills"]');
    const iconInput = document.querySelector('input[name="icon_class"]');
    const bgColorSelect = document.querySelector('select[name="icon_bg_color"]');
    const textColorSelect = document.querySelector('select[name="icon_text_color"]');
    
    const previewName = document.getElementById('preview-name');
    const previewAge = document.getElementById('preview-age');
    const previewSkills = document.getElementById('preview-skills');
    const previewIcon = document.getElementById('preview-icon');
    const previewIconBg = document.getElementById('preview-icon-bg');
    
    function updatePreview() {
        previewName.textContent = nameInput.value || '--';
        previewAge.textContent = ageInput.value || '--';
        
        // Update skills
        const skills = skillsInput.value.split('\n').filter(skill => skill.trim());
        if (skills.length > 0) {
            previewSkills.innerHTML = skills.slice(0, 4).map(skill => 
                `<div>${skill.trim()}</div>`
            ).join('');
            if (skills.length > 4) {
                previewSkills.innerHTML += '<div class="text-gray-400">... và nhiều kỹ năng khác</div>';
            }
        } else {
            previewSkills.innerHTML = '<div>Nhập kỹ năng để xem trước</div>';
        }
        
        // Update icon
        previewIcon.className = (iconInput.value || 'fas fa-baby') + ' text-2xl ' + textColorSelect.value;
        previewIconBg.className = 'w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 ' + bgColorSelect.value;
    }
    
    // Add event listeners
    [nameInput, ageInput, skillsInput, iconInput].forEach(input => {
        input.addEventListener('input', updatePreview);
    });
    
    [bgColorSelect, textColorSelect].forEach(select => {
        select.addEventListener('change', updatePreview);
    });
});
</script>
{% endblock %}

