{% extends "admin/base.html" %}

{% block title %}Chỉnh sửa Theme - {{ theme.theme_name }}{% endblock %}
{% block page_title %}Chỉnh sửa Theme{% endblock %}
{% block page_description %}Cập nhật giao diện và màu sắc cho "{{ theme.theme_name }}"{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <a href="{{ url_for('admin_themes') }}" 
               class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="fas fa-arrow-left text-gray-600"></i>
            </a>
            <div class="p-3 bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl shadow-lg">
                <i class="fas fa-edit text-white text-xl"></i>
            </div>
            <div>
                <h2 class="text-2xl font-bold text-gray-900">Chỉnh sửa Theme</h2>
                <p class="text-gray-600">Cập nhật giao diện và màu sắc cho "{{ theme.theme_name }}"</p>
            </div>
        </div>
        
        <!-- Theme Status -->
        <div class="flex items-center space-x-3">
            {% if theme.is_active %}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 border border-green-200">
                <i class="fas fa-check-circle mr-1"></i>
                Đang sử dụng
            </span>
            {% endif %}
            {% if theme.is_default %}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 border border-blue-200">
                <i class="fas fa-star mr-1"></i>
                Mặc định
            </span>
            {% endif %}
        </div>
    </div>

    <form method="POST" class="grid lg:grid-cols-2 gap-8">
        <!-- Form Section -->
        <div class="space-y-6">
            <!-- Basic Info -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                    Thông tin cơ bản
                </h3>
                
                <div class="space-y-4">
                    <div>
                        <label for="theme_name" class="block text-sm font-medium text-gray-700 mb-2">
                            Tên Theme <span class="text-red-500">*</span>
                        </label>
                        <input type="text" 
                               id="theme_name" 
                               name="theme_name" 
                               value="{{ theme.theme_name }}"
                               required
                               placeholder="Ví dụ: Cam Hướng Dương, Xanh Biển..."
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        <p class="text-xs text-gray-500 mt-1">Tên mô tả cho theme của bạn</p>
                    </div>
                </div>
            </div>

            <!-- Color Settings -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-palette mr-2 text-purple-500"></i>
                    Cài đặt màu sắc
                </h3>
                
                <div class="grid sm:grid-cols-2 gap-6">
                    <!-- Primary Color -->
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-700">
                            Màu Chính <span class="text-red-500">*</span>
                        </label>
                        <div class="flex items-center space-x-3">
                            <div class="relative">
                                <input type="color" 
                                       id="primary_color" 
                                       name="primary_color" 
                                       value="{{ theme.primary_color }}" 
                                       required
                                       class="w-16 h-16 rounded-xl border-2 border-gray-200 cursor-pointer hover:scale-105 transition-transform">
                                <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-star text-white text-xs"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <input type="text" 
                                       id="primary_color_text" 
                                       value="{{ theme.primary_color }}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">Logo, tiêu đề, nút chính</p>
                            </div>
                        </div>
                    </div>

                    <!-- Secondary Color -->
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-700">
                            Màu Phụ <span class="text-red-500">*</span>
                        </label>
                        <div class="flex items-center space-x-3">
                            <div class="relative">
                                <input type="color" 
                                       id="secondary_color" 
                                       name="secondary_color" 
                                       value="{{ theme.secondary_color }}" 
                                       required
                                       class="w-16 h-16 rounded-xl border-2 border-gray-200 cursor-pointer hover:scale-105 transition-transform">
                                <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-palette text-white text-xs"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <input type="text" 
                                       id="secondary_color_text" 
                                       value="{{ theme.secondary_color }}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">Gradient, hiệu ứng hover</p>
                            </div>
                        </div>
                    </div>

                    <!-- Accent Color -->
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-700">
                            Màu Nhấn
                        </label>
                        <div class="flex items-center space-x-3">
                            <div class="relative">
                                <input type="color" 
                                       id="accent_color" 
                                       name="accent_color" 
                                       value="{{ theme.accent_color or '#ffd700' }}"
                                       class="w-16 h-16 rounded-xl border-2 border-gray-200 cursor-pointer hover:scale-105 transition-transform">
                                <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-yellow-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-sparkles text-white text-xs"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <input type="text" 
                                       id="accent_color_text" 
                                       value="{{ theme.accent_color or '#ffd700' }}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">Chi tiết đặc biệt (tùy chọn)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Background Color -->
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-700">
                            Màu Nền
                        </label>
                        <div class="flex items-center space-x-3">
                            <div class="relative">
                                <input type="color" 
                                       id="background_color" 
                                       name="background_color" 
                                       value="{{ theme.background_color or '#ffffff' }}"
                                       class="w-16 h-16 rounded-xl border-2 border-gray-200 cursor-pointer hover:scale-105 transition-transform">
                                <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-gray-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-fill text-white text-xs"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <input type="text" 
                                       id="background_color_text" 
                                       value="{{ theme.background_color or '#ffffff' }}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">Nền chính của website</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Text Color -->
                <div class="mt-6 space-y-3">
                    <label class="block text-sm font-medium text-gray-700">
                        Màu Chữ
                    </label>
                    <div class="flex items-center space-x-3 max-w-sm">
                        <div class="relative">
                            <input type="color" 
                                   id="text_color" 
                                   name="text_color" 
                                   value="{{ theme.text_color or '#333333' }}"
                                   class="w-16 h-16 rounded-xl border-2 border-gray-200 cursor-pointer hover:scale-105 transition-transform">
                            <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-gray-800 rounded-full flex items-center justify-center">
                                <i class="fas fa-font text-white text-xs"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <input type="text" 
                                   id="text_color_text" 
                                   value="{{ theme.text_color or '#333333' }}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">Màu chữ chính</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Theme Info -->
            <div class="bg-gradient-to-r from-gray-50 to-blue-50 rounded-2xl p-6 border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                    <i class="fas fa-info mr-2 text-blue-500"></i>
                    Thông tin theme
                </h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <span class="text-gray-600">Ngày tạo:</span>
                        <p class="font-medium text-gray-900">{{ theme.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
                    </div>
                    <div>
                        <span class="text-gray-600">Cập nhật cuối:</span>
                        <p class="font-medium text-gray-900">{{ theme.updated_at.strftime('%d/%m/%Y %H:%M') }}</p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button type="submit" 
                        class="flex-1 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-medium py-3 px-6 rounded-xl hover:from-amber-600 hover:to-orange-600 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center justify-center">
                    <i class="fas fa-save mr-2"></i>
                    Cập nhật Theme
                </button>
                {% if not theme.is_active %}
                <form method="POST" action="{{ url_for('admin_theme_switch', theme_id=theme.id) }}" class="flex-1">
                    <button type="submit" 
                            onclick="return confirm('Bạn có chắc muốn chuyển sang theme này?')"
                            class="w-full bg-gradient-to-r from-green-500 to-emerald-500 text-white font-medium py-3 px-6 rounded-xl hover:from-green-600 hover:to-emerald-600 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center justify-center">
                        <i class="fas fa-check mr-2"></i>
                        Sử dụng Theme
                    </button>
                </form>
                {% endif %}
                <a href="{{ url_for('admin_themes') }}" 
                   class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors duration-200 flex items-center justify-center">
                    <i class="fas fa-times mr-2"></i>
                    Hủy
                </a>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="space-y-6">
            <!-- Live Preview -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100 sticky top-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-eye mr-2 text-green-500"></i>
                    Xem trước trực tiếp
                </h3>
                
                <div id="theme-preview" class="space-y-4 transition-all duration-300">
                    <!-- Header Preview -->
                    <div id="preview-header" class="rounded-xl p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-seedling text-white text-xl"></i>
                                </div>
                                <div>
                                    <h1 class="text-xl font-bold">Trường Mầm non Hoa Hướng Dương</h1>
                                    <p class="text-sm opacity-90">Nơi ươm mầm tương lai</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content Preview -->
                    <div id="preview-content" class="rounded-xl p-6 shadow-md">
                        <h2 class="text-xl font-bold mb-3" id="preview-text">Chào mừng đến với trường chúng tôi</h2>
                        <p class="text-gray-600 mb-4 text-sm">Chúng tôi cam kết mang đến môi trường giáo dục tốt nhất cho con em bạn.</p>
                        
                        <div class="space-y-3">
                            <div id="preview-button" class="inline-block px-4 py-2 text-white font-medium rounded-lg shadow-md text-sm">
                                Tìm hiểu thêm
                            </div>
                            <div id="preview-button-outline" class="inline-block px-4 py-2 border-2 font-medium rounded-lg text-sm ml-2">
                                Liên hệ ngay
                            </div>
                        </div>
                        
                        <!-- Color Palette Display -->
                        <div class="mt-6 pt-4 border-t border-gray-200">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">Bảng màu hiện tại</h4>
                            <div class="flex space-x-2">
                                <div id="color-swatch-primary" class="w-8 h-8 rounded-lg shadow-md border-2 border-white ring-1 ring-gray-200"></div>
                                <div id="color-swatch-secondary" class="w-8 h-8 rounded-lg shadow-md border-2 border-white ring-1 ring-gray-200"></div>
                                <div id="color-swatch-accent" class="w-8 h-8 rounded-lg shadow-md border-2 border-white ring-1 ring-gray-200"></div>
                                <div id="color-swatch-background" class="w-8 h-8 rounded-lg shadow-md border-2 border-white ring-1 ring-gray-200"></div>
                                <div id="color-swatch-text" class="w-8 h-8 rounded-lg shadow-md border-2 border-white ring-1 ring-gray-200"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Before/After Comparison -->
            <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-100">
                <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                    <i class="fas fa-history mr-2 text-amber-500"></i>
                    So sánh thay đổi
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Màu gốc</h4>
                        <div class="flex space-x-2">
                            <div class="w-6 h-6 rounded-md shadow-sm border border-gray-200" 
                                 style="background-color: {{ theme.primary_color }};" 
                                 title="Màu chính gốc: {{ theme.primary_color }}"></div>
                            <div class="w-6 h-6 rounded-md shadow-sm border border-gray-200" 
                                 style="background-color: {{ theme.secondary_color }};" 
                                 title="Màu phụ gốc: {{ theme.secondary_color }}"></div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Màu mới</h4>
                        <div class="flex space-x-2">
                            <div id="new-primary-swatch" class="w-6 h-6 rounded-md shadow-sm border border-gray-200"></div>
                            <div id="new-secondary-swatch" class="w-6 h-6 rounded-md shadow-sm border border-gray-200"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Design Tips -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6 border border-blue-100">
                <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
                    <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                    Gợi ý cải thiện
                </h3>
                <div class="space-y-2 text-sm text-gray-700">
                    <div class="flex items-start space-x-2">
                        <i class="fas fa-check text-green-500 mt-0.5"></i>
                        <span>Kiểm tra độ tương phản màu để đảm bảo khả năng đọc</span>
                    </div>
                    <div class="flex items-start space-x-2">
                        <i class="fas fa-check text-green-500 mt-0.5"></i>
                        <span>Xem trước theme trên nhiều thiết bị khác nhau</span>
                    </div>
                    <div class="flex items-start space-x-2">
                        <i class="fas fa-check text-green-500 mt-0.5"></i>
                        <span>Đảm bảo màu sắc phù hợp với thương hiệu trường</span>
                    </div>
                    <div class="flex items-start space-x-2">
                        <i class="fas fa-check text-green-500 mt-0.5"></i>
                        <span>Lưu bản sao lưu trước khi thay đổi lớn</span>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const colorInputs = ['primary_color', 'secondary_color', 'accent_color', 'background_color', 'text_color'];
    
    // Initialize color input synchronization
    colorInputs.forEach(function(inputId) {
        const colorInput = document.getElementById(inputId);
        const textInput = document.getElementById(inputId + '_text');
        
        if (colorInput && textInput) {
            colorInput.addEventListener('input', function() {
                textInput.value = this.value;
                updatePreview();
            });
            
            textInput.addEventListener('input', function() {
                if (this.value.match(/^#[0-9A-F]{6}$/i)) {
                    colorInput.value = this.value;
                    updatePreview();
                }
            });
        }
    });
    
    // Update preview function
    function updatePreview() {
        const primaryColor = document.getElementById('primary_color').value;
        const secondaryColor = document.getElementById('secondary_color').value;
        const accentColor = document.getElementById('accent_color').value;
        const backgroundColor = document.getElementById('background_color').value;
        const textColor = document.getElementById('text_color').value;
        
        // Update header
        const header = document.getElementById('preview-header');
        header.style.background = `linear-gradient(135deg, ${primaryColor}, ${secondaryColor})`;
        
        // Update content background
        const content = document.getElementById('preview-content');
        content.style.backgroundColor = backgroundColor;
        
        // Update text color
        const text = document.getElementById('preview-text');
        text.style.color = textColor;
        
        // Update buttons
        const button = document.getElementById('preview-button');
        button.style.background = `linear-gradient(135deg, ${primaryColor}, ${secondaryColor})`;
        
        const buttonOutline = document.getElementById('preview-button-outline');
        buttonOutline.style.borderColor = primaryColor;
        buttonOutline.style.color = primaryColor;
        
        // Update color swatches
        document.getElementById('color-swatch-primary').style.backgroundColor = primaryColor;
        document.getElementById('color-swatch-secondary').style.backgroundColor = secondaryColor;
        document.getElementById('color-swatch-accent').style.backgroundColor = accentColor;
        document.getElementById('color-swatch-background').style.backgroundColor = backgroundColor;
        document.getElementById('color-swatch-text').style.backgroundColor = textColor;
        
        // Update comparison swatches
        document.getElementById('new-primary-swatch').style.backgroundColor = primaryColor;
        document.getElementById('new-secondary-swatch').style.backgroundColor = secondaryColor;
    }
    
    // Initial preview update
    updatePreview();
    
    // Add form validation
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const themeName = document.getElementById('theme_name').value.trim();
        if (!themeName) {
            e.preventDefault();
            alert('Vui lòng nhập tên theme');
            document.getElementById('theme_name').focus();
            return;
        }
        
        // Show loading state
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Đang cập nhật...';
        submitBtn.disabled = true;
        
        // Re-enable if form submission fails
        setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }, 5000);
    });
    
    // Add smooth animations on page load
    const elements = document.querySelectorAll('.bg-white, .bg-gradient-to-r');
    elements.forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            el.style.transition = 'all 0.5s ease';
            el.style.opacity = '1';
            el.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // Add change detection
    let hasChanges = false;
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('input', () => {
            hasChanges = true;
        });
    });
    
    // Warn before leaving if there are unsaved changes
    window.addEventListener('beforeunload', function(e) {
        if (hasChanges) {
            e.preventDefault();
            e.returnValue = '';
        }
    });
    
    // Reset change detection on form submit
    form.addEventListener('submit', () => {
        hasChanges = false;
    });
});
</script>
{% endblock %}
