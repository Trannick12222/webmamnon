{% extends "admin/base.html" %}

{% block title %}Tạo sự kiện mới - Admin{% endblock %}
{% block page_title %}Tạo sự kiện mới{% endblock %}
{% block page_description %}Thêm sự kiện mới cho trường{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <form method="POST" enctype="multipart/form-data" class="space-y-6">
        <div class="admin-card p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">Thông tin sự kiện</h2>
            
            <div class="grid grid-cols-1 gap-6">
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                        Tên sự kiện <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="title" name="title" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                           placeholder="Ví dụ: Lễ Trung Thu 2024">
                </div>
                
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                        Mô tả sự kiện <span class="text-red-500">*</span>
                    </label>
                    <textarea id="description" name="description" rows="4" required
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                              placeholder="Mô tả chi tiết về sự kiện..."></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="event_date" class="block text-sm font-medium text-gray-700 mb-2">
                            Ngày tổ chức <span class="text-red-500">*</span>
                        </label>
                        <input type="date" id="event_date" name="event_date" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    
                    <div>
                        <label for="event_time" class="block text-sm font-medium text-gray-700 mb-2">
                            Giờ bắt đầu <span class="text-red-500">*</span>
                        </label>
                        <input type="time" id="event_time" name="event_time" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                               value="08:00">
                    </div>
                </div>
                
                <div>
                    <label for="location" class="block text-sm font-medium text-gray-700 mb-2">
                        Địa điểm
                    </label>
                    <input type="text" id="location" name="location"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                           placeholder="Ví dụ: Sân trường Hoa Hướng Dương">
                </div>
            </div>
        </div>
        
        <div class="admin-card p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">Hình ảnh sự kiện</h2>
            
            <div class="space-y-4">
                <div>
                    <label for="featured_image" class="block text-sm font-medium text-gray-700 mb-2">
                        Chọn hình ảnh đại diện
                    </label>
                    <div class="flex items-center justify-center w-full">
                        <label for="featured_image" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6" id="upload-placeholder">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                                <p class="mb-2 text-sm text-gray-500">
                                    <span class="font-semibold">Nhấp để tải lên</span> hoặc kéo thả
                                </p>
                                <p class="text-xs text-gray-500">PNG, JPG, JPEG (MAX. 16MB)</p>
                            </div>
                            <input id="featured_image" name="featured_image" type="file" class="hidden" 
                                   accept="image/*" onchange="previewImage(this, 'image-preview')">
                        </label>
                    </div>
                </div>
                
                <!-- Image Preview -->
                <div id="image-preview-container" class="hidden">
                    <div class="border border-gray-300 rounded-lg p-4 bg-white">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Xem trước hình ảnh</h3>
                        <div class="max-w-full max-h-96 overflow-hidden">
                            <img id="image-preview" class="max-w-full rounded-lg" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="admin-card p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">Cài đặt</h2>
            
            <div class="flex items-center">
                <input id="is_active" name="is_active" type="checkbox" checked
                       class="h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded">
                <label for="is_active" class="ml-2 block text-sm text-gray-900">
                    Kích hoạt và hiển thị trên website
                </label>
            </div>
        </div>
        
        <div class="flex items-center justify-between pt-6">
            <a href="{{ url_for('admin_events') }}" 
               class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition duration-200">
                <i class="fas fa-arrow-left mr-2"></i>Quay lại
            </a>
            
            <button type="submit"
                    class="btn-primary px-6 py-3 rounded-lg hover:bg-orange-600 transition duration-200">
                <i class="fas fa-plus mr-2"></i>Tạo sự kiện
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function previewImage(input, previewId) {
        const file = input.files[0];
        if (file) {
            const preview = document.getElementById(previewId);
            const container = document.getElementById('image-preview-container');
            const placeholder = document.getElementById('upload-placeholder');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                container.classList.remove('hidden');
                placeholder.innerHTML = `
                    <i class="fas fa-check-circle text-4xl text-green-500 mb-4"></i>
                    <p class="text-sm text-green-600 font-medium">Đã chọn: ${file.name}</p>
                    <p class="text-xs text-gray-500">Nhấp để thay đổi</p>
                `;
            };
            reader.readAsDataURL(file);
        }
    }
    
    // Form validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const title = document.getElementById('title').value.trim();
        const description = document.getElementById('description').value.trim();
        const eventDate = document.getElementById('event_date').value;
        const eventTime = document.getElementById('event_time').value;
        
        if (!title || !description || !eventDate || !eventTime) {
            e.preventDefault();
            alert('Vui lòng điền đầy đủ thông tin bắt buộc!');
            return false;
        }
        
        // Check if event date is in the future
        const selectedDate = new Date(eventDate + 'T' + eventTime);
        const now = new Date();
        
        if (selectedDate < now) {
            const confirm = window.confirm('Ngày giờ sự kiện đã qua. Bạn có chắc chắn muốn tạo sự kiện này không?');
            if (!confirm) {
                e.preventDefault();
                return false;
            }
        }
    });
    
    // Set minimum date to today
    document.getElementById('event_date').min = new Date().toISOString().split('T')[0];
</script>
{% endblock %}